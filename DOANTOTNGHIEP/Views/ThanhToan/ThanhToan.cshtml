
@{
    ViewBag.Title = "DangTin";
    Layout = "~/Views/Layout/_LayoutNhatro.cshtml";

    var user = @ViewBag.User;
}
<div class="container" style="margin-top: 20px;">
    <div class="group_fields_body col-md-8">
        <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">Bảng giá đăng tin</div>
        <div class="table-responsive">
            <table class="table table_banggia table-bordered">
                <thead>
                    <tr>
                        <th style="text-align: left;">Loại tin</th>
                        <th style="text-align: right;">Gói ngày</th>
                        <th style="text-align: right;">Gói tuần (7 ngày)</th>
                        <th style="text-align: right;">Gói tháng (30 ngày)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <span style="color: #E13427; font-weight: bold;">Tin VIP nổi bật</span>
                        </td>
                        <td align="right">
                            <span class="spanprice">50.000 đ</span>
                        </td>
                        <td align="right">
                            <span class="spanprice">315.000 đ</span>
                        </td>
                        <td align="right">
                            <span class="spanprice">1.200.000 đ</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span style="color: #3763e0; font-weight: bold;">Tin HOT</span>
                        </td>
                        <td align="right">
                            <span class="spanprice">10.000 đ</span>
                        </td>
                        <td align="right">
                            <span class="spanprice">63.000 đ</span>
                        </td>
                        <td align="right">
                            <span class="spanprice">240.000 đ</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span style="color: #055699; font-weight: bold;">Tin thường</span>
                        </td>
                        <td align="right">
                            <span class="spanprice">2.000 đ</span>
                        </td>
                        <td align="right">
                            <span class="spanprice">12.000 đ</span>
                        </td>
                        <td align="right">
                            <span class="spanprice">48.000 đ</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">Chọn hình thức đăng tin</div>
        <div class="row">
            <div class="col-md-4">
                <div class="form-group">
                    <span>Loại tin</span>
                    <select class="form-control js-choose-package-vip" id="package_id" name="package_id">
                        <option value="">Chọn loại tin</option>
                        <option value="2">Tin VIP nổi bật</option>
                        <option value="1">Tin Hot</option>
                        <option value="0">Tin thường</option>
                    </select>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <span>Gói thời gian</span>
                    <select class="form-control js-goi-thoi-gian" id="package_time" name="package_time">
                        <option value="day">Đăng theo ngày</option>
                        <option value="week">Đăng theo tuần</option>
                        <option value="month">Đăng theo tháng</option>
                    </select>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group select_group_dangtheongay js-wrap-dang-theo js-wrap-dang-theo-ngay" id="byday" data-by="day">
                    <span>Số ngày</span>
                    <select class="form-control" id="total_day" name="total_day">
                        <option value="3">3 ngày</option>
                        <option value="4">4 ngày</option>
                        <option value="5">5 ngày</option>
                        <option value="6">6 ngày</option>
                    </select>
                </div>
                <div class="form-group select_group_dangtheotuan js-wrap-dang-theo js-wrap-dang-theo-tuan" id="byweek" data-by="week">
                    <span>Số tuần</span>
                    <select class="form-control" id="total_week" name="total_week">
                        <option value="1">1 tuần</option>
                        <option value="2">2 tuần</option>
                        <option value="3">3 tuần</option>
                    </select>
                </div>
                <div class="form-group select_group_dangtheothang js-wrap-dang-theo js-wrap-dang-theo-thang" id="bymonth" data-by="month">
                    <span>Số tháng</span>
                    <select class="form-control" id="total_month" name="total_month">
                        <option value="1">1 tháng</option>
                        <option value="2">2 tháng</option>
                        <option value="3">3 tháng</option>
                        <option value="4">4 tháng</option>
                        <option value="5">5 tháng</option>
                        <option value="6">6 tháng</option>
                        <option value="7">7 tháng</option>
                        <option value="8">8 tháng</option>
                        <option value="9">9 tháng</option>
                        <option value="10">10 tháng</option>
                        <option value="11">11 tháng</option>
                        <option value="12">12 tháng</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
    <div class="payment_info hidden-xs col-md-6" style="width: 300px; margin-left: 20px">
        <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">Thông tin thanh toán</div>
        <div class="content">
            <table class="table _table-bordered">
                <tbody>
                    <tr>
                        <td>Bạn đang có:</td>
                        <td>@user.Balance đ</td>
                    </tr>
                    <tr>
                        <td>Đơn giá:</td>
                        <td class="js-package-price"></td> 
                    </tr>
                    <tr>
                        <td>Số ngày:</td>
                        <td class="js-package-days">-</td>
                    </tr>
                    <tr>
                        <td>Ngày hết hạn</td>
                        <td class="js-package-deadline">-</td>
                    </tr>
                    <tr>
                        <td>Thành tiền:</td>
                        <td>
                            <span style="font-size: 20px; font-weight: bold; color: #F90;" class="js-package-grand-total">- </span> <span style="font-size: 20px; font-weight: bold; color: #F90;" class="">đ</span>
                        </td>
                    </tr>
                </tbody>
            </table>

            <input type="button" id="thanhtoan" class="btn btn-auth-submit" value="Xác Nhận">
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $("#byweek").hide();
        $("#bymonth").hide();
        $("#package_time").on('change', function () {
            var data = $("#package_time").val();
            if (data == 'week') {
                $("#byday").hide();
                $("#bymonth").hide();
                $("#byweek").show();
            }

            if (data == 'month') {
                $("#byday").hide();
                $("#byweek").hide();
                $("#bymonth").show();
            }

            if (data == 'day') {
                $("#byday").show();
                $("#byweek").hide();
                $("#bymonth").hide();
            }
        });

        $("#package_id, #package_time, #total_day, #total_week, #total_month").on('change', function () {
            var value = $("#package_id").val();
            var data = $("#package_time").val();
            var pricebyday = $("#total_day").val();
            var pricebyweek = $("#total_week").val();
            var pricebymonth = $("#total_month").val();
            var price = 0;
            var totalprice = 0;
            var day = 0;
            if (value == 0 && data == 'day') {
                totalprice = 2000 * pricebyday;
                price = 2000;
                day = 1 * pricebyday;
            }
            else if (value == 0 && data == 'week') {
                totalprice = 12000 * pricebyweek;
                price = 12000;
                day = 7 * pricebyweek;
            }
            else if (value == 0 && data == 'month') {
                totalprice = 48000 * pricebymonth;
                price = 48000;
                day = 30 * pricebymonth;
            }
            else if (value == 1 && data == 'day') {
                totalprice = 50000 * pricebyday;
                price = 50000;
                day = 1 * pricebyday;
            }
            else if (value == 1 && data == 'week') {
                totalprice = 315000 * pricebyweek;
                price = 315000;
                day = 7 * pricebyweek;
            }
            else if (value == 1 && data == 'month') {
                totalprice = 1200000 * pricebymonth;
                price = 1200000;
                day = 30 * pricebymonth;
            }

            else if (value == 2 && data == 'day') {
                totalprice = 10000 * pricebyday;
                price = 10000;
                day = 1 * pricebyday;
            }
            else if (value == 2 && data == 'week') {
                totalprice = 63000 * pricebyweek;
                price = 63000;
                day = 7 * pricebyweek;
            }
            else if (value == 2 && data == 'month') {
                totalprice = 240000 * pricebymonth;
                price = 240000
                day = 30 * pricebymonth;
            }
            else {
                price = 0;
                totalprice = 0;
                day = 0;
            }


            $(".js-package-price").empty();
            $(".js-package-price").append(price);

            $(".js-package-grand-total").empty();
            $(".js-package-grand-total").append(totalprice);

            $(".js-package-days").empty();
            $(".js-package-days").append(day + " Ngày");

            var today = new Date(Date.now());
            today.setDate(today.getDate() + day);

            var dd = today.getDate();
            var mm = today.getMonth() + 1; //January is 0!

            var yyyy = today.getFullYear();
            if (dd < 10) {
                dd = '0' + dd;
            }
            if (mm < 10) {
                mm = '0' + mm;
            }
            var today = dd + '/' + mm + '/' + yyyy;

            $(".js-package-deadline").empty();
            $(".js-package-deadline").append(today);


        }); 
        
        // click button
        $("#thanhtoan").click(function () {
            var ExpireDate = $(".js-package-deadline").html();
            var TotalPrice = $(".js-package-grand-total").html();
            var UserId = @user.Id;
            var IsLevel = $("#package_id").val();
            if (@user.Balance < TotalPrice ) {
                alert('Tài Khoản bạn không đủ');
            }

            $.ajax({
                type: 'POST',
                url: "/ThanhToan/PostThanhToan/",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: JSON.stringify({
                    ExpireDate: ExpireDate,
                    TotalPrice: TotalPrice,
                    UserId: UserId,
                    IsLevel: IsLevel,
                })
            }).success(function (response) {
                if (response.result == true) {
                    alert("Thành Công!");
                    window.location.href = '/Home/Index';
                }

                else {
                    alert("Thất Bại");
                }
            }).error(function () {
                alert("Lỗi serve!");
                window.location.reload();
            });
        });
    })

   

</script>